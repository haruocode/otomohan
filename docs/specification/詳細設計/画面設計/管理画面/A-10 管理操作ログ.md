# A-10 管理操作ログ

これは管理画面の中でも **最重要クラスのセキュリティ機能** であり、内部不正・誤操作・不透明な処理を防ぐために必須の機能です。

---

# 1. 画面概要

管理者が行った全ての操作を **監査目的で記録・閲覧できる画面**。

目的：

- 誤操作・不正操作の即時発見
- 誰が、いつ、何をしたかの完全履歴を保つ
- セキュリティインシデント対応
- 法的/内部統制への対応

三原則：

1. **改ざん不可であること**
2. **すべての重要操作が残ること**
3. **検索・追跡できること**

---

# 2. ログとして記録すべき操作

以下は必ず記録対象：

### ■ ユーザー管理系（A-02）

- ユーザー凍結 / 解除
- ポイント調整
- 個人情報の参照

### ■ おともはん管理系（A-03）

- ステータス変更（承認 / 停止 / 凍結）
- プロフィール編集
- 稼働設定の変更

### ■ 通話ログ系（A-04）

- 通話ログ閲覧
- 録音データ再生（特権操作）

### ■ ポイント管理（A-05）

- ポイント付与 / 調整

### ■ 通知管理（A-07）

- 通知配信
- テンプレ更新

### ■ 通報管理（A-08）

- 審査結果の登録
- 警告 / 凍結実行

### ■ レビュー管理（A-09）

- レビュー削除
- フラグ付与

---

# 3. ログに保存されるデータ項目

1. ログID
2. 管理者ID
3. 操作種別（user_suspend / otomo_update / notification_send 等）
4. 対象ID（ユーザーID・おともはんID・通話IDなど）
5. 操作日時
6. IPアドレス
7. 操作詳細（JSONで保持）
8. 成功 / 失敗
9. エラーメッセージ（失敗時）

例（JSON）：

```json
{
  "adminId": "admin_02",
  "action": "otomo_suspend",
  "target": "otomo_03",
  "timestamp": "2025-02-01T12:40:22Z",
  "ip": "192.168.1.40",
  "detail": {
    "reason": "暴言の疑い",
    "previousStatus": "active",
    "newStatus": "suspended"
  },
  "result": "success"
}
```

---

# 4. 画面構造（UI）

## **ヘッダー**

| 左           | 中央         | 右       |
| ------------ | ------------ | -------- |
| 管理メニュー | 管理操作ログ | 特になし |

# 5. メインコンテンツ

## ① 検索フィルター（強力）

項目：

- 管理者ID
- 操作種別（ドロップダウン）
  - ユーザー操作
  - おともはん操作
  - 通知送信
  - ポイント調整
  - レビュー削除
  - etc.
- 対象ID（ユーザーID・おともはんIDなど）
- 日付範囲（From - To）
- 成功/失敗
- IPアドレス
- キーワード検索（理由 / JSON の一部）

→ 検索 → テーブル更新

---

## ② 操作ログ一覧（テーブル表示）

| 項目     | 説明             |
| -------- | ---------------- |
| ログID   | `log_9331`       |
| 管理者ID | `admin_02`       |
| 操作種別 | otomo_suspend    |
| 対象ID   | otomo_03         |
| 日時     | 2025/02/01 12:40 |
| 結果     | success / failed |
| 操作     | 詳細             |

結果ステータスタグ：

- success → 緑
- failed → 赤

---

## ③ 操作ログ詳細画面（モーダル or 新ページ）

### ● 基本情報

```
ログID：log_9331
管理者：admin_02
操作種別：otomo_suspend
対象：otomo_03
日時：2025/02/01 12:40
IP：192.168.1.40
結果：success
```

---

### ● 操作内容の詳細（JSONビュー）

```
reason: "暴言の疑い"
previousStatus: "active"
newStatus: "suspended"
```

JSONは階層構造を折りたたみ可能に。

---

### ● 連携リンク

対象がユーザー or おともはんの場合：

```
[ おともはん管理（otomo_03）へ移動 ]
```

対象が通話ログの場合：

```
[ 通話ログ（call_220）を開く ]
```

---

### ● セキュアな扱い

- 詳細はコピー不可（選択禁止オプションも可）
- ダウンロードは権限者のみ

---

# 6. 重要なシステム要件

## ■ 改ざん不可

ログは「**Append Only（追記のみ）**」で保存され、変更不可。

## ■ 保存期間

標準：1〜3年

（音声サービスの場合は法務的観点で1年以上推奨）

## ■ バックアップ

定期バックアップ必須。

## ■ アクセス権限

閲覧権限：

- 通常管理者：検索＋閲覧
- 上位管理者（super-admin）：すべて閲覧可能（録音再生含む）

---

# 7. API 連動

| 用途             | API                                   |
| ---------------- | ------------------------------------- |
| ログ一覧取得     | GET /admin/audit                      |
| ログ詳細取得     | GET /admin/audit/{id}                 |
| フィルタ検索     | GET /admin/audit?admin=xxx&action=xxx |
| （自動）ログ記録 | POST /admin/audit                     |

※ POST はシステム内部で呼ばれ、人が直接叩くことはない。

---

# 8. 画面レイアウト（概略）

```
[メニュー]              管理操作ログ

検索：
[管理者ID] [操作種別▼] [対象ID] [期間] [成功/失敗] [検索]

---------------------------------------------------------------------------
ID        管理者     種別              対象      日時              結果   詳細
log9331   admin02    otomo_suspend     otomo03   2025/02/01 12:40   成功   >
log9330   admin01    review_delete     rev1021   2025/02/01 12:38   成功   >
log9328   admin03    user_points_edit  user22    2025/02/01 12:22   失敗   >
---------------------------------------------------------------------------

（詳細画面）
ログID：log9331
管理者：admin02
操作：otomo_suspend
対象：otomo03
結果：success

JSON：
{
  "reason": "暴言の疑い",
  "previousStatus": "active",
  "newStatus": "suspended"
}

[ otomo_03 の管理画面へ ]
```

![C-03 プロフィール編集.png](A-10%20%E7%AE%A1%E7%90%86%E6%93%8D%E4%BD%9C%E3%83%AD%E3%82%B0/C-03_%E3%83%95%E3%82%9A%E3%83%AD%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E7%B7%A8%E9%9B%86.png)
