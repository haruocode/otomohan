# A-05 ポイント管理

ユーザー／おともはん向けの U / O 系とは異なり、**運営者がポイント状況を監視・操作・履歴検索できる管理画面** として構成します。

---

# 1. 画面概要

この画面では運営者が以下のポイント情報を確認・操作できる：

- ユーザーの残ポイント
- ポイントの増減（手動付与／調整）
- 購入履歴（決済ログ）
- 使用履歴（通話での消費明細）
- 不正利用チェック（高速消費・異常挙動など）

監査性が重要なため、**検索性能・履歴の可視性・操作ログの記録** に重点を置く。

---

# 2. 画面構造

---

## **ヘッダー**

| 要素 | 内容 |
| --- | --- |
| 左 | 管理メニュー（ハンバーガー） |
| 中央 | ポイント管理 |
| 右 | 管理者プロフィール／ログアウト |

---

# 3. メインコンテンツ

---

## ① ユーザー検索エリア

検索条件：

- **ユーザーID / メールアドレス**
- **おともはんID（otomo_XXX）**
- **名前（部分一致）**

検索ボタン押下で下部に該当ユーザーのポイント情報を表示。

---

## ② ユーザーのポイント概要（カード表示）

検索後に表示される情報：

```
ユーザー名：たろう
ユーザーID：user_123
残ポイント：720 pt
累計購入：4,800 pt
累計使用：4,100 pt
```

右上に「詳細を見る」ボタン。

---

## ③ ポイント履歴タブ

タブ切り替え構成：

### ● 購入履歴

| 日付 | 購入ポイント | 金額 | 決済手段 | トランザクションID |
| --- | --- | --- | --- | --- |

例）

2025/01/30 | 300pt | ¥360 | クレカ | tr_abc123

---

### ● 使用履歴（通話消費）

| 日付 | 消費ポイント | 通話ID | 相手 | 通話時間 |
| --- | --- | --- | --- | --- |

例）

2025/01/30 | 100pt | call_55 | さくら | 1分

---

### ● 管理者操作ログ（必須）

| 日付 | 操作 | 担当者 | 変更量 | 理由 |
| --- | --- | --- | --- | --- |

例）

2025/01/29 | 手動付与 | admin_ito | +100pt | 問い合わせ対応

---

## ④ ポイント調整（手動操作）

運営者が以下の操作を行える：

### ● ポイント付与

- 入力欄：付与ポイント
- 理由（必須）
- 「付与する」ボタン

### ● ポイント減算（調整）

- 入力欄：減算ポイント
- 理由（必須）
- 「減算する」ボタン

いずれも確認モーダル必須：

```
ポイントを 100pt 増やしますか？
この操作は取り消せません。
[キャンセル] [実行する]
```

---

# 4. 不正利用チェック（任意だが推奨）

管理者が異常挙動を検出できるように：

- **短時間に大量消費（例：1分で500pt）**
- **課金なしで消費だけが続く**
- **連続通話リクエストによるBOT疑惑**

疑わしい動作があるユーザーには赤いマーカー表示：

```
⚠ 不正利用の可能性があります
```

---

# 5. API 連動

### ユーザー検索

`GET /admin/users?query=xxx`

### ポイント概要

`GET /admin/users/{id}/points`

### ポイント付与

`POST /admin/users/{id}/points/add`

### ポイント減算

`POST /admin/users/{id}/points/subtract`

### 購入履歴

`GET /admin/users/{id}/purchase-history`

### 使用履歴

`GET /admin/users/{id}/usage-history`

### 管理者操作ログ

`GET /admin/users/{id}/admin-logs`

---

# 6. 権限管理（RBAC）

- 運営アカウント（admin）だけがアクセス可能
- ポイント増減は **権限 "finance" を持つアカウントのみ**
- すべての操作は監査ログ化

---

# 7. 画面レイアウト（概略）

```
[メニュー]           ポイント管理              [admin]

[ユーザー検索]
 ユーザーID / メール / 名前 [検索]

------------------------------------------

[ポイント概要カード]
 ユーザー：たろう
 残ポイント：720pt
 累計購入：4800pt
 累計使用：4100pt
 [詳細を開く]

------------------------------------------

[タブ]
 (購入履歴) (使用履歴) (管理ログ)

  購入履歴一覧------

------------------------------------------

[ポイント調整]
 + [付与ポイント入力]  理由  [付与する]
 - [減算ポイント入力]  理由  [減算する]
```

---

# 8. デザイン仕様

- 管理画面なのでダークテーマでなくてもよい（白 or 黒は選択可能）
- ただし統一性を考慮し、
    
    **黒 + ネオンブルー/ピンク系** の管理UIも可能
    
- テーブル主体で可読性最優先
- フォームのバリデーションを厳格に