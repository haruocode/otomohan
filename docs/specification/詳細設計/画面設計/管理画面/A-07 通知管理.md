# A-07 通知管理

# 1. 画面概要

管理者がアプリ内通知を作成・配信・管理するための画面。

主な用途：

- お知らせ配信（メンテナンス、機能追加、障害情報）
- おともはん向け通知（収益レポート、審査結果など）
- ユーザー向け通知（ポイント購入促進、キャンペーンなど）
- 既存通知の一覧管理・検索
- 配信ステータスの確認（成功・失敗件数）

---

# 2. 通知の種類（カテゴリ設計）

通知カテゴリ：

- **システム**：メンテナンス、障害
- **アップデート**：新機能、改善
- **キャンペーン**：ポイント増量、イベント告知
- **おともはん向け**：審査結果、収益レポート
- **ユーザー向け**：ポイント不足、チャージ促進
- **重要**：利用停止、違反警告

---

# 3. 画面構造（UI）

---

## **ヘッダー**

| 要素 | 内容                     |
| ---- | ------------------------ |
| 左   | 管理メニュー             |
| 中央 | 通知管理                 |
| 右   | 新規通知作成ボタン（＋） |

---

# 4. メインコンテンツ

---

## ① 通知検索フィルター

検索条件：

- タイトル
- 通知タイプ（カテゴリ）
- 配信対象（ユーザー / おともはん / 全体）
- 配信日時（範囲）
- 配信ステータス（予約 / 配信済 / 下書き / 失敗）

検索ボタン → 一覧更新。

---

## ② 通知一覧（テーブル）

項目：

| 項目     | 説明                               |
| -------- | ---------------------------------- |
| タイトル | 通知タイトル                       |
| カテゴリ | システム / アップデート / 重要など |
| 対象     | ユーザー / おともはん / 全体       |
| 状態     | 下書き / 予約 / 配信済 / 失敗      |
| 配信日時 | YYYY/MM/DD HH:MM                   |
| 操作     | 編集 / 詳細                        |

状態タグ：

- 下書き：グレー
- 予約：青
- 配信済：緑
- 失敗：赤

---

## ③ 通知詳細画面（モーダル or 別ページ）

表示項目：

### 1) 基本情報

```
タイトル：新機能のお知らせ
本文：
  新しい通話UIが追加されました。

カテゴリ：アップデート
対象：全体
配信日時：2025/02/01 12:00
状態：配信済み
```

---

### 2) 配信結果（重要）

```
配信成功：12,311件
配信失敗：42件
失敗ログ：CSVダウンロード
```

失敗ログ：

- デバイストークン無効
- 通知拒否設定
- 資格情報失効など

---

### 3) プレビュー（ユーザー側でどのように見えるか）

スマホ通知・アプリ内通知の両方を確認できる。

---

## ④ 新規作成 / 編集画面（A-07 のコア）

フォーム項目：

### ● タイトル

（最大50文字）

### ● 本文

（リッチテキスト可能 / 最大500文字）

### ● カテゴリ選択

- システム
- キャンペーン
- 重要
- など

### ● 対象ユーザー

チェックボックス：

```
[ ] 全ユーザー
[ ] 一般ユーザーのみ
[ ] おともはんのみ
[ ] 特定ユーザー → ID指定
```

### ● 配信方式

```
( ) 今すぐ配信
( ) 予約配信 → 日付と時刻を指定
```

### ● 通知チャンネル

- アプリ内通知（In-app）
- プッシュ通知（将来）
- メール（任意・将来）

### ● 保存 / 下書き / 配信ボタン

```
[下書き保存]  [テスト送信]  [配信する]
```

“テスト送信” → 管理者自身の端末へ試験通知

---

# 5. 通知インフラ連携（設計視点）

API：

| 用途         | API                                  |
| ------------ | ------------------------------------ |
| 通知一覧取得 | GET /admin/notifications             |
| 通知作成     | POST /admin/notifications            |
| 通知編集     | PUT /admin/notifications/{id}        |
| 通知詳細     | GET /admin/notifications/{id}        |
| 配信実行     | POST /admin/notifications/{id}/send  |
| 配信結果     | GET /admin/notifications/{id}/result |

通知配信ワーカー（バックエンド）：

- DB に保存
- ワーカーが非同期配信
- 配信後結果をDBに格納
- 失敗ログを書き出す

Push通知の場合：

Firebase FCM / APNs などと接続

---

# 6. セキュリティ / 運用要件

- 重要通知（利用停止）は **二重確認モーダル** 必須
- 通知内容の改ざん防止（A-10 で操作ログ保存）
- 下書きは複数管理者が参照可能（編集ロックも任意）
- 配信結果の保持期限は 6〜12ヶ月目安

---

# 7. デザイン仕様

- 管理画面らしくシンプルな白 or 黒背景
- カテゴリタグで色分け
- 通知本文のプレビューは実機風カードで表示
- 一覧はテーブルで整然と

---

# 8. 画面レイアウト（概略）

```
[メニュー]         通知管理                [＋新規]

検索：
[タイトル] [カテゴリ▼] [対象▼] [状態▼] [検索]

------------------------------------------------------------
タイトル             カテゴリ     対象         状態     配信日時    操作
メンテのお知らせ     システム     全体         配信済   2/1 12:00   詳細 編集
ポイント2倍CP        キャンペーン ユーザー     予約     2/3 00:00   詳細 編集
審査結果通知         おともはん   個別         下書き   -          詳細 編集
------------------------------------------------------------

（詳細画面）
タイトル：メンテのお知らせ
本文：2/5 2:00よりメンテナンスを実施します。
配信結果：成功 12,311 / 失敗 42
```
