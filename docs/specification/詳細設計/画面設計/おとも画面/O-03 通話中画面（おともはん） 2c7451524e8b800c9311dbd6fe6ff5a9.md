# O-03 通話中画面（おともはん）

# 1. 画面概要

おともはん側が通話中に利用する画面。

ユーザー側（U-04）とは構造が類似しているが、

- **おともはん側はポイント消費がない**
- **通話時間・稼働時間の表示**
- **おともはんが通話を終了できるボタン**
- **ユーザー側の音声状態の確認（任意）**

など、運営者（おともはん）視点で必要な情報が反映される。

---

# 2. 画面構造（UI）

---

## **ヘッダー**

| 要素 | 内容 |
| --- | --- |
| 左 | ＜ 戻る（通話終了確認モーダルへ遷移） |
| 中央 | 通話中 |
| 右 | 接続状態アイコン（●緑：安定 / ●黄：不安定 / ●赤：危険）※任意 |

※ 戻る＝即終了ではなく、「通話を終了しますか？」の確認モーダルを必ず挟む。

---

# 3. メインコンテンツ

---

## ① ユーザー情報（相手）

- 大きめの丸いプロフィール写真（リアル寄り）
- 相手の名前（例：たろうさん）
- ステータス
    - ● 赤：「通話接続中」
    - または「音声が聞こえています」「相手がミュート中」など任意拡張可

---

## ② 通話タイマー（最重要）

```
通話時間： 07:32
```

- 白文字 & 大きく表示
- 稼働時間・報酬計算に関係するため強調表示

---

## ③ 通話状態サブ情報（任意）

例：

- 音声品質（良好 / 普通 / 不安定）
- 接続方式：SFU（mediasoup）
- 相手のマイク状態：ON / OFF

※ 運営向け機能として拡張しやすいように設計。

---

## ④ 自分の音声コントロール（おともはん）

ユーザー側と同じUI構成で統一：

- **ミュート**（マイクアイコン）
- **スピーカー切替**
- **マイクテスト（任意）**

中央下部に配置、丸いボタン、ピンク/ブルーのネオン縁取り。

---

## ⑤ おともはん側の終了ボタン

大きめの赤〜ピンク系ボタン：

```
通話を終了する
```

- 押下 → サマリー画面（O-04）へ遷移
- 勝手な誤操作防止のため確認モーダル必須

---

## ⑥ 通話終了確認モーダル（重要）

```
通話を終了しますか？
相手との接続が切れ、通話時間の計測が停止します。

[キャンセル]   [終了する]
```

---

# 4. 通話中のイベント表示（任意）

運営として必要性が高い場合は画面下に小さく表示：

- 「相手のネットワークが不安定です」
- 「音声ストリームが途切れました」
- 「相手がアプリをバックグラウンドに移動しました」

mediasoup の Producer/Consumer の状態から取得できる。

---

# 5. API / WebSocket 連動

| 機能 | 仕様 |
| --- | --- |
| 通話開始（接続確立） | WS-S04（SFU版 call_connected） |
| 毎分稼働集計 | WS-S05（call_tick） ※おともはん側はポイント加算なし（運用次第で実装可） |
| 通話終了 | POST /calls/end または WS-S07（RTP 停止通知） |
| 異常切断検出 | Producer close / Transport close で検知 |

---

# 6. 状態遷移（簡易）

```
O-01 待機
    ↓（着信）
O-02 着信画面
    ↓（応答）
O-03 通話中画面（本画面）
    ↓（終了）
O-04 通話終了サマリー
```

---

# 7. デザイン仕様（シリーズ統一）

- ダークモード
- ピンク/ブルーのネオンアクセント
- ボタンは丸く光沢あり
- タイマーは中央で大きく
- おともはん視点の「管理感」を加えた UI

U 系との一貫性を持たせつつ、O 系は少しだけプロ向けの落ち着いたトーンにする。

---

# 8. 画面レイアウト（概略）

```
[＜][通話中]     [接続 ●良好]

       [ユーザー写真]
          たろう さん
        ● 通話接続中

      通話時間：07:32

  (音声状態：良好)  (任意)

   [ミュート]  [スピーカー]

        [ 通話を終了する ]
```